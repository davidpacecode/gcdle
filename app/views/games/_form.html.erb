<%= form_with(model: game, class: "contents") do |form| %>
  <% if game.errors.any? %>
    <div id="error_explanation" class="bg-red-50 text-red-500 px-3 py-2 font-medium rounded-md mt-3">
      <h2><%= pluralize(game.errors.count, "error") %> prohibited this game from being saved:</h2>

      <ul class="list-disc ml-6">
        <% game.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="flex justify-center space-x-1" id="wordle-grid">
    <% 5.times do |i| %>
      <input 
        type="text" 
        maxlength="1"
        class="w-12 h-12 text-center text-xl border-2 rounded focus:outline-none focus:ring-2 focus:ring-primary"
        id="letter-<%= i %>"
        name="guess[<%= i %>]"
        data-index="<%= i %>"

        <% if i == 0 %>
          autofocus
          hx-on:load="this.focus()"
        <% end %>

        hx-on:keyup="
          // Move forward after typing a character
          if (event.key.length === 1) {
            const next = document.getElementById('letter-<%= i + 1 %>');
            if (next) {
              setTimeout(() => next.focus(), 5);
            }
          }
          
          // Handle backspace: move back AND clear current cell
          if (event.key === 'Backspace') {
            // If current cell has content, just clear it
            if (this.value !== '') {
              this.value = '';
            } 
            // If current cell is already empty, move to previous and clear it
            else {
              const prev = document.getElementById('letter-<%= i - 1 %>');
              if (prev) {
                prev.focus();
                prev.value = ''; // Clear the previous cell too
              }
            }
          }
        "
      />
    <% end %>
  </div>

  <div class="inline">
    <%= form.submit class: "w-full sm:w-auto rounded-md px-3.5 py-2.5 bg-blue-600 hover:bg-blue-500 text-white inline-block font-medium cursor-pointer" %>
  </div>
<% end %>
